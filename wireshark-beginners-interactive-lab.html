<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wireshark for Beginners - Interactive Lab</title>
    <!-- Load Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for a more "app-like" feel */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4a5568; /* gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #718096; /* gray-500 */
        }
        /* Style for the selected packet */
        .packet-row.selected {
            background-color: #4a5568; /* gray-600 */
        }
        .packet-row:hover {
            background-color: #2d3748; /* gray-800 */
        }
    </style>
</head>
<body class="font-sans antialiased text-gray-200 bg-gray-900 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="w-full p-4 bg-gray-800 border-b border-gray-700 shadow-lg">
        <h1 class="text-2xl font-bold text-center text-white">Wireshark for Beginners: Interactive Lab</h1>
    </header>

    <!-- Main Content (Lab + Simulator) -->
    <div class="flex flex-1 h-full overflow-hidden">

        <!-- Lab Guide Sidebar -->
        <aside class="w-full md:w-1/3 lg:w-1/4 h-full flex flex-col p-4 bg-gray-800 border-r border-gray-700 overflow-y-auto">
            <h2 class="text-xl font-semibold mb-4 text-white pb-2 border-b border-gray-600">Lab Steps</h2>
            <div id="step-content" class="flex-grow space-y-4">
                <!-- Lab steps will be injected here by JavaScript -->
            </div>
            <div id="lab-message" class="mt-4 p-3 rounded-lg text-white font-medium hidden"></div>
            <div class="flex justify-between mt-6">
                <button id="prev-step" class="px-4 py-2 bg-gray-600 rounded-lg hover:bg-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">
                    Previous
                </button>
                <button id="next-step" class="px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">
                    Next
                </button>
            </div>
        </aside>

        <!-- Wireshark Simulator -->
        <main class="w-full md:w-2/3 lg:w-3/4 h-full flex flex-col bg-gray-900">
            
            <!-- Toolbar -->
            <div class="flex items-center p-2 space-x-2 bg-gray-700 border-b border-gray-600">
                <button id="start-capture" title="Start Capture" class="p-2 text-green-400 bg-gray-800 rounded-lg hover:bg-gray-600">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" opacity="0.1" /><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.707-10.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L9.414 11H13a1 1 0 100-2H9.414l1.293-1.293z" clip-rule="evenodd" transform="rotate(90 10 10)"/></svg>
                </button>
                <button id="stop-capture" title="Stop Capture" class="p-2 text-red-400 bg-gray-800 rounded-lg hover:bg-gray-600" disabled>
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"></path></svg>
                </button>
                <button id="save-capture" title="Save Capture" class="p-2 text-blue-400 bg-gray-800 rounded-lg hover:bg-gray-600">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293zM9 4a1 1 0 012 0v2H9V4z"></path></svg>
                </button>
            </div>

            <!-- Filter Bar -->
            <div class="flex p-2 bg-gray-700">
                <input id="filter-input" type="text" placeholder="Apply a display filter... (e.g., http)" class="flex-grow p-2 text-white bg-gray-800 border border-gray-600 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <button id="apply-filter" class="px-4 py-2 font-semibold text-white bg-blue-600 rounded-r-lg hover:bg-blue-500 focus:outline-none">Apply</button>
                <button id="clear-filter" title="Clear Filter" class="p-2 ml-2 text-gray-400 bg-gray-800 rounded-lg hover:bg-gray-600">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </div>

            <!-- Packet List Pane -->
            <div class="flex-grow p-2 overflow-y-auto" style="height: 40vh;">
                <table id="packet-table" class="w-full text-sm text-left whitespace-nowrap">
                    <thead class="sticky top-0 text-xs text-gray-300 uppercase bg-gray-700">
                        <tr>
                            <th scope="col" class="px-3 py-2">No.</th>
                            <th scope="col" class="px-3 py-2">Time</th>
                            <th scope="col" class="px-3 py-2">Source</th>
                            <th scope="col" class="px-3 py-2">Destination</th>
                            <th scope="col" class="px-3 py-2">Protocol</th>
                            <th scope="col" class="px-3 py-2">Length</th>
                            <th scope="col" class="px-3 py-2">Info</th>
                        </tr>
                    </thead>
                    <tbody class="bg-gray-800 divide-y divide-gray-700">
                        <!-- Packets will be injected here -->
                    </tbody>
                </table>
            </div>

            <!-- Packet Details Pane -->
            <div class="p-2 border-t-2 border-gray-700" style="height: 30vh;">
                <h3 class="text-lg font-semibold text-white mb-2">Packet Details</h3>
                <div class="h-full p-3 font-mono text-sm bg-gray-800 rounded-lg overflow-y-auto">
                    <pre id="details-content">Select a packet to see its details.</pre>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- MOCK DATA --------------------------------------------------------
        
        // This is our pre-recorded "packet capture"
        const allPackets = [
            { no: 1, time: 0.0000, src: '192.168.1.10', dst: '8.8.8.8', proto: 'DNS', len: 74, info: 'Standard query 0x1a2b A www.google.com', details: `Domain Name System (query)
    Transaction ID: 0x1a2b
    Flags: 0x0100 (Standard query)
    Questions: 1
    Answer RRs: 0
    Authority RRs: 0
    Additional RRs: 0
    Queries
        www.google.com: type A, class IN` },
            { no: 2, time: 0.0451, src: '8.8.8.8', dst: '192.168.1.10', proto: 'DNS', len: 90, info: 'Standard query response 0x1a2b A 142.250.190.100', details: `Domain Name System (response)
    Transaction ID: 0x1a2b
    Flags: 0x8180 (Standard query response, No error)
    Questions: 1
    Answer RRs: 1
    Answers
        www.google.com: type A, class IN, addr 142.250.190.100` },
            { no: 3, time: 0.0500, src: '192.168.1.10', dst: '142.250.190.100', proto: 'TCP', len: 66, info: '51234 → 443 [SYN]', details: `Transmission Control Protocol, Src Port: 51234, Dst Port: 443, Seq: 0, Len: 0
    Flags: 0x002 (SYN)` },
            { no: 4, time: 0.0952, src: '142.250.190.100', dst: '192.168.1.10', proto: 'TCP', len: 66, info: '443 → 51234 [SYN, ACK]', details: `Transmission Control Protocol, Src Port: 443, Dst Port: 51234, Seq: 0, Ack: 1, Len: 0
    Flags: 0x012 (SYN, ACK)` },
            { no: 5, time: 0.0953, src: '192.168.1.10', dst: '142.250.190.100', proto: 'TCP', len: 54, info: '51234 → 443 [ACK]', details: `Transmission Control Protocol, Src Port: 51234, Dst Port: 443, Seq: 1, Ack: 1, Len: 0
    Flags: 0x010 (ACK)` },
            { no: 6, time: 0.1000, src: '192.168.1.10', dst: '142.250.190.100', proto: 'TLSv1.3', len: 569, info: 'Client Hello', details: `Transport Layer Security
    TLSv1.3 Record Layer: Handshake Protocol: Client Hello
    Content Type: Handshake (22)
    Version: TLS 1.2 (0x0303)
    Length: 512` },
            { no: 7, time: 0.1500, src: '142.250.190.100', dst: '192.168.1.10', proto: 'TLSv1.3', len: 1400, info: 'Server Hello, Change Cipher Spec, Application Data', details: `Transport Layer Security
    TLSv1.3 Record Layer: Handshake Protocol: Server Hello
    ...
    TLSv1.3 Record Layer: Change Cipher Spec
    ...
    TLSv1.3 Record Layer: Application Data` },
            { no: 8, time: 0.1600, src: '192.168.1.10', dst: '142.250.190.100', proto: 'TLSv1.3', len: 90, info: 'Application Data', details: `Transport Layer Security
    TLSv1.3 Record Layer: Application Data
    (Encrypted HTTPS Request for www.google.com)` },
            { no: 9, time: 0.2000, src: '192.168.1.10', dst: '8.8.8.8', proto: 'DNS', len: 72, info: 'Standard query 0x1a2c A example.com', details: `Domain Name System (query)
    Transaction ID: 0x1a2c
    ...
    Queries
        example.com: type A, class IN` },
            { no: 10, time: 0.2450, src: '8.8.8.8', dst: '192.168.1.10', proto: 'DNS', len: 88, info: 'Standard query response 0x1a2c A 93.184.216.34', details: `Domain Name System (response)
    Transaction ID: 0x1a2c
    ...
    Answers
        example.com: type A, class IN, addr 93.184.216.34` },
            { no: 11, time: 0.2500, src: '192.168.1.10', dst: '93.184.216.34', proto: 'TCP', len: 66, info: '51236 → 80 [SYN]', details: `Transmission Control Protocol, Src Port: 51236, Dst Port: 80, Seq: 0, Len: 0
    Flags: 0x002 (SYN)` },
            { no: 12, time: 0.2950, src: '93.184.216.34', dst: '192.168.1.10', proto: 'TCP', len: 66, info: '80 → 51236 [SYN, ACK]', details: `Transmission Control Protocol, Src Port: 80, Dst Port: 51236, Seq: 0, Ack: 1, Len: 0
    Flags: 0x012 (SYN, ACK)` },
            { no: 13, time: 0.2951, src: '192.168.1.10', dst: '93.184.216.34', proto: 'TCP', len: 54, info: '51236 → 80 [ACK]', details: `Transmission Control Protocol, Src Port: 51236, Dst Port: 80, Seq: 1, Ack: 1, Len: 0
    Flags: 0x010 (ACK)` },
            { no: 14, time: 0.3000, src: '192.168.1.10', dst: '93.184.216.34', proto: 'HTTP', len: 400, info: 'GET / HTTP/1.1', details: `Hypertext Transfer Protocol
    GET / HTTP/1.1
    Host: example.com
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
    Accept: text/html...` },
            { no: 15, time: 0.3500, src: '93.184.216.34', dst: '192.168.1.10', proto: 'HTTP', len: 1400, info: 'HTTP/1.1 200 OK (text/html)', details: `Hypertext Transfer Protocol
    HTTP/1.1 200 OK
    Content-Type: text/html; charset=UTF-8
    Content-Length: 1256
    ...
    [HTML Data: <html><head><title>Example Domain</title>...</html>]` },
            { no: 16, time: 0.4000, src: '192.168.1.1', dst: '224.0.0.251', proto: 'MDNS', len: 80, info: 'Standard query 0x0000 PTR _http._tcp.local', details: `Multicast Domain Name System (query)` },
        ];

        // --- LAB STEP DATA ----------------------------------------------------

        const labSteps = [
            {
                title: "Welcome to the Wireshark Lab!",
                content: `
                    <p>In this lab, we'll simulate using Wireshark to capture and analyze network traffic.</p>
                    <p class="mt-2">Your role is a security analyst detecting traffic on a company server. Our (simulated) IP address is <strong>192.168.1.10</strong>.</p>
                    <p class="mt-2">Click "Next" to begin.</p>
                `,
                task: () => true // No task, just intro
            },
            {
                title: "Step 1: Start a Packet Capture",
                content: `
                    <p>First, we need to start capturing packets.</p>
                    <p class="mt-2">Click the <strong>Start Capture</strong> button (the green play icon) in the toolbar to begin the simulated packet capture.</p>
                `,
                task: (state) => state.captureStarted
            },
            {
                title: "Step 2: Detect HTTPS Packets",
                content: `
                    <p>Great! Packets are flowing. Now, let's filter for secure web traffic (HTTPS).</p>
                    <p class="mt-2">HTTPS runs on top of <strong>TLS</strong> (Transport Layer Security).</p>
                    <p class="mt-2">Type <code>tls</code> into the filter bar and click <strong>Apply</strong>.</p>
                `,
                task: (state) => state.filterText === 'tls'
            },
            {
                title: "Step 3: Practice - Detect HTTP Packets",
                content: `
                    <p>Good. You've isolated the encrypted traffic. Now let's find the unencrypted traffic.</p>
                    <p class="mt-2">Clear the filter, then type <code>http</code> into the filter bar and click <strong>Apply</strong>.</p>
                `,
                task: (state) => state.filterText === 'http'
            },
            {
                title: "Step 4: Detect a Specific IP Address",
                content: `
                    <p>We visited <strong>example.com</strong>, which our DNS query (Packet 10) showed has the IP <strong>93.184.216.34</strong>.</p>
                    <p class="mt-2">Let's find all traffic to AND from that server. Clear the filter, then type:</p>
                    <code class="block bg-gray-700 p-2 rounded-md my-2">ip.addr == 93.184.216.34</code>
                `,
                task: (state) => state.filterText === 'ip.addr == 93.184.216.34'
            },
            {
                title: "Step 5: Exclude an IP Address",
                content: `
                    <p>Sometimes you want to hide "noise" from your own machine (<strong>192.168.1.10</strong>) to see what else is on the network.</p>
                    <p class="mt-2">Use the "not" operator (<code>!=</code>). Clear the filter, then type:</p>
                    <code class="block bg-gray-700 p-2 rounded-md my-2">ip.addr != 192.168.1.10</code>
                `,
                task: (state) => state.filterText === 'ip.addr != 192.168.1.10'
            },
            {
                title: "Step 6: Capstone Task",
                content: `
                    <p>Let's combine what we've learned.</p>
                    <p class="mt-2"><strong>Goal:</strong> Find all HTTP and HTTPS packets that were <strong>sent from</strong> our computer (<strong>192.168.1.10</strong>).</p>
                    <p class="mt-2">Use this filter:</p>
                    <code class="block bg-gray-700 p-2 rounded-md my-2">(http || tls) && ip.src == 192.168.1.10</code>
                `,
                task: (state) => state.filterText === '(http || tls) && ip.src == 192.168.1.10'
            },
            {
                title: "Project Complete!",
                content: `
                    <p>Congratulations!</p>
                    <p class="mt-2">You've successfully used Wireshark's display filters to capture and analyze web traffic.</p>
                    <p class="mt-2">You now know how to:
                        <ul class="list-disc list-inside ml-4 mt-2">
                            <li>Start and stop a capture</li>
                            <li>Filter for protocols (HTTP, TLS)</li>
                            <li>Filter for specific IPs</li>
                            <li>Exclude IPs</li>
                            <li>Combine filters with operators</li>
                        </ul>
                    </p>
                `,
                task: () => false
            }
        ];

        // --- SIMULATOR LOGIC --------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            // Get DOM elements
            const startBtn = document.getElementById('start-capture');
            const stopBtn = document.getElementById('stop-capture');
            const saveBtn = document.getElementById('save-capture');
            const filterInput = document.getElementById('filter-input');
            const applyFilterBtn = document.getElementById('apply-filter');
            const clearFilterBtn = document.getElementById('clear-filter');
            const packetTableBody = document.querySelector('#packet-table tbody');
            const detailsContent = document.getElementById('details-content');
            const stepContent = document.getElementById('step-content');
            const prevStepBtn = document.getElementById('prev-step');
            const nextStepBtn = document.getElementById('next-step');
            const labMessage = document.getElementById('lab-message');

            // Lab state
            let currentStep = 0;
            let captureInterval;
            let capturedPackets = [];
            let displayedPackets = [];
            let captureIndex = 0;
            let isCapturing = false;
            let selectedRow = null;

            // Lab global state for task validation
            let labState = {
                captureStarted: false,
                filterText: ''
            };

            // --- Packet & Capture Logic ---

            function getProtoColor(proto) {
                if (proto === 'HTTP') return 'bg-blue-900/50';
                if (proto.includes('TLS')) return 'bg-purple-900/50';
                if (proto === 'TCP') return 'bg-gray-600/50';
                if (proto === 'DNS') return 'bg-yellow-900/50';
                if (proto === 'MDNS') return 'bg-orange-900/50';
                return 'bg-gray-800';
            }

            function renderPacketList(packets) {
                packetTableBody.innerHTML = '';
                displayedPackets = packets;

                packets.forEach((packet, index) => {
                    const tr = document.createElement('tr');
                    tr.className = `packet-row cursor-pointer ${getProtoColor(packet.proto)}`;
                    tr.setAttribute('data-packet-id', packet.no);
                    tr.innerHTML = `
                        <td class="px-3 py-1">${packet.no}</td>
                        <td class="px-3 py-1">${packet.time.toFixed(4)}</td>
                        <td class="px-3 py-1">${packet.src}</td>
                        <td class="px-3 py-1">${packet.dst}</td>
                        <td class="px-3 py-1">${packet.proto}</td>
                        <td class="px-3 py-1">${packet.len}</td>
                        <td class="px-3 py-1">${packet.info}</td>
                    `;
                    tr.addEventListener('click', () => showDetails(packet, tr));
                    packetTableBody.appendChild(tr);
                });
            }

            function showDetails(packet, rowElement) {
                detailsContent.textContent = packet.details;
                if (selectedRow) {
                    selectedRow.classList.remove('selected');
                }
                rowElement.classList.add('selected');
                selectedRow = rowElement;
            }

            function startCapture() {
                if (isCapturing) return;
                isCapturing = true;
                labState.captureStarted = true;
                
                capturedPackets = [];
                captureIndex = 0;
                renderPacketList(capturedPackets);
                detailsContent.textContent = 'Capture in progress...';

                startBtn.disabled = true;
                stopBtn.disabled = false;

                captureInterval = setInterval(() => {
                    if (captureIndex < allPackets.length) {
                        const packet = allPackets[captureIndex];
                        capturedPackets.push(packet);
                        // Only render if no filter is applied
                        if (filterInput.value === '') {
                            renderPacketList(capturedPackets);
                        }
                        captureIndex++;
                    } else {
                        stopCapture();
                    }
                }, 200); // Add one packet every 200ms
                
                checkTaskCompletion();
            }

            function stopCapture() {
                if (!isCapturing) return;
                isCapturing = false;
                clearInterval(captureInterval);
                startBtn.disabled = false;
                stopBtn.disabled = true;
                if (detailsContent.textContent === 'Capture in progress...') {
                    detailsContent.textContent = 'Capture stopped. Select a packet to see details.';
                }
            }
            
            function saveCapture() {
                showLabMessage('success', 'Capture saved to file (Simulation)');
            }

            // --- Filter Logic ---

            function applyFilter() {
                const filterText = filterInput.value.trim();
                labState.filterText = filterText; // Update lab state
                let filtered = [];

                if (filterText === '') {
                    filtered = capturedPackets;
                } else {
                    // Use a switch for the specific filters in the lab
                    switch(filterText) {
                        case 'http':
                            filtered = capturedPackets.filter(p => p.proto === 'HTTP');
                            break;
                        case 'tls':
                            filtered = capturedPackets.filter(p => p.proto.includes('TLS'));
                            break;
                        case 'ip.addr == 93.184.216.34':
                            filtered = capturedPackets.filter(p => p.src === '93.184.216.34' || p.dst === '93.184.216.34');
                            break;
                        case 'ip.addr != 192.168.1.10':
                            filtered = capturedPackets.filter(p => p.src !== '192.168.1.10' && p.dst !== '192.168.1.10');
                            break;
                        case '(http || tls) && ip.src == 192.168.1.10':
                            filtered = capturedPackets.filter(p => (p.proto === 'HTTP' || p.proto.includes('TLS')) && p.src === '192.168.1.10');
                            break;
                        default:
                            // Basic fallback for simple protocols
                            filtered = capturedPackets.filter(p => p.proto.toLowerCase().includes(filterText.toLowerCase()));
                            if (filtered.length === 0) {
                                showLabMessage('error', 'Invalid or unsupported filter syntax for this lab.');
                            }
                    }
                }
                
                renderPacketList(filtered);
                checkTaskCompletion();
            }

            function clearFilter() {
                filterInput.value = '';
                labState.filterText = '';
                renderPacketList(capturedPackets);
                checkTaskCompletion();
            }

            // --- Lab Step Logic ---

            function renderStep(stepIndex) {
                if (stepIndex < 0 || stepIndex >= labSteps.length) return;
                
                const step = labSteps[stepIndex];
                stepContent.innerHTML = `
                    <h3 class="text-lg font-semibold text-white">${step.title}</h3>
                    <div class="space-y-2 text-gray-300">${step.content}</div>
                `;
                
                prevStepBtn.disabled = (stepIndex === 0);
                nextStepBtn.disabled = (stepIndex === labSteps.length - 1);
                
                // Check task completion for the new step
                checkTaskCompletion();
            }
            
            function checkTaskCompletion() {
                const step = labSteps[currentStep];
                if (step.task(labState)) {
                    showLabMessage('success', 'Task complete!');
                    if (currentStep < labSteps.length - 1) {
                        nextStepBtn.disabled = false;
                    }
                } else {
                    showLabMessage('pending', 'Task pending...');
                    if (currentStep < labSteps.length - 1) {
                        nextStepBtn.disabled = true;
                    }
                }
            }
            
            function showLabMessage(type, message) {
                labMessage.textContent = message;
                labMessage.classList.remove('hidden', 'bg-green-600', 'bg-red-600', 'bg-gray-600');
                if (type === 'success') {
                    labMessage.classList.add('bg-green-600');
                } else if (type === 'error') {
                    labMessage.classList.add('bg-red-600');
                } else {
                    labMessage.classList.add('bg-gray-600');
                }
                labMessage.classList.remove('hidden');

                if (type === 'success' || type === 'error') {
                    setTimeout(() => {
                        if (labMessage.textContent === message) { // Only hide if message hasn't changed
                             labMessage.classList.add('hidden');
                        }
                    }, 3000);
                }
            }

            function goToNextStep() {
                if (currentStep < labSteps.length - 1) {
                    currentStep++;
                    renderStep(currentStep);
                }
            }

            function goToPrevStep() {
                if (currentStep > 0) {
                    currentStep--;
                    renderStep(currentStep);
                }
            }

            // --- Event Listeners ---
            startBtn.addEventListener('click', startCapture);
            stopBtn.addEventListener('click', stopCapture);
            saveBtn.addEventListener('click', saveCapture);
            applyFilterBtn.addEventListener('click', applyFilter);
            clearFilterBtn.addEventListener('click', clearFilter);
            filterInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    applyFilter();
                }
            });

            nextStepBtn.addEventListener('click', goToNextStep);
            prevStepBtn.addEventListener('click', goToPrevStep);

            // Initial setup
            renderStep(0);
        });

    </script>
</body>
</html>
